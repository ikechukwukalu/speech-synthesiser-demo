<!DOCTYPE html>
<html lang="en">

<head>
    <title>Merchnat Pay</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>

    <div class="container">
        <h1 align="center">Speech synthesiser</h1>

        <p align="center">Enter some text in the input below and press return to hear it. change voices using the
            dropdown menu.</p>

        <form>
            <input class="form-control txt" type="text">
            <div>
                <label for="rate">Rate</label><input class="form-control" type="range" min="0.5" max="2" value="1"
                    step="0.1" id="rate">
                <div class="rate-value">1</div>
                <div class="clearfix"></div>
            </div>
            <div>
                <label for="pitch">Pitch</label><input class="form-control" type="range" min="0" max="2" value="1"
                    step="0.1" id="pitch">
                <div class="pitch-value">1</div>
                <div class="clearfix"></div>
            </div>
            <select class="form-control">

            </select>
        </form>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            var inputForm = document.querySelector('form');
            var inputTxt = document.querySelector('.txt');
            var voiceSelect = document.querySelector('select');

            var pitch = document.querySelector('#pitch');
            var pitchValue = document.querySelector('.pitch-value');
            var rate = document.querySelector('#rate');
            var rateValue = document.querySelector('.rate-value');

            var voices = [];

            function populateVoiceList() {
                voices = window.speechSynthesis.getVoices();
                for (i = 0; i < voices.length; i++) {
                    var option = document.createElement('option');
                    option.textContent = voices[i].name + ' (' + voices[i].lang + ')';

                    if (voices[i].default) {
                        option.textContent += ' -- DEFAULT';
                    }

                    option.setAttribute('data-lang', voices[i].lang);
                    option.setAttribute('data-name', voices[i].name);
                    voiceSelect.appendChild(option);
                }
            }
            populateVoiceList();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populateVoiceList;
            }

            inputForm.onsubmit = function (event) {
                event.preventDefault();
                window.speechSynthesis.cancel();
                var synth = window.speechSynthesis;

                var utterThis = new SpeechSynthesisUtterance(inputTxt.value);
                var selectedOption = voiceSelect.selectedOptions[0].getAttribute('data-name');
                for (i = 0; i < voices.length; i++) {
                    if (voices[i].name === selectedOption) {
                        utterThis.voice = voices[i];
                    }
                }
                
                utterThis.pitch = pitch.value;
                utterThis.rate = rate.value;
                utterThis.volume = 0.5;
                synth.speak(utterThis);

                console.log(utterThis, window.speechSynthesis);

                utterThis.onpause = function (event) {
                    var char = event.utterance.text.charAt(event.charIndex);
                    console.log('Speech paused at character ' + event.charIndex + ' of "' +
                        event.utterance.text + '", which is "' + char + '".');
                }
                inputTxt.blur();
            }

            pitch.onchange = function () {
                pitchValue.textContent = pitch.value;
            }

            rate.onchange = function () {
                rateValue.textContent = rate.value;
            }
        });

    </script>
</body>

</html>